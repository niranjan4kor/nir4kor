/********************************************************************************
* Copyright (c) 2021 Contributors to the Eclipse Foundation
*
* See the NOTICE file(s) distributed with this work for additional
* information regarding copyright ownership.
*
* This program and the accompanying materials are made available under the
* terms of the Eclipse Public License 2.0 which is available at
* http://www.eclipse.org/legal/epl-2.0
*
* SPDX-License-Identifier: EPL-2.0
********************************************************************************/
{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "dapr-SeatAdjuster-run",
			"appId": "seatadjuster",
			"appPort": 50008,
			"componentsPath": "./.dapr/components",
			"config": "./.dapr/config.yaml",
			"appProtocol": "grpc",
			"grpcPort": 50001,
			"httpPort": 3500,
			"type": "dapr",
		},
		{
			"label": "dapr-SeatAdjuster-stop",
			"type": "shell",
			"command": [
				"dapr stop --app-id seatadjuster"
			],
			"presentation": {
				"close": true,
				"reveal": "never"
			},
		},
		{
			"label": "ensure-dapr",
			"type": "shell",
			"command": "./.vscode/scripts/ensure-dapr.sh --task",
			"group": "none",
			"presentation": {
				"close": true
			}
		},
		{
			"label": "run-mosquitto",
			"type": "shell",
			"command": "./.vscode/scripts/run-mosquitto.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 4
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^\\d{10}: mosquitto version \\d{1}\\.\\d{1}\\.\\d{1} starting$",
					"endsPattern": "^\\d{10}: Opening ipv6 listen socket on port \\d{3,5}\\.$"
				}
			}
		},
		{
			"label": "run-vehicledatabroker",
			"type": "shell",
			"command": "./.vscode/scripts/run-vehicledatabroker.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^You're up and running! Dapr logs will appear here.",
					"endsPattern": "."
				}
			}
		},
		{
			"label": "run-vehicledatabroker-cli",
			"type":"shell",
			"command": "./.vscode/scripts/run-vehicledatabroker-cli.sh --task",
			"group": "none",
			"isBackground": false,
		},
		{
			"label": "run-seatservice",
			"type": "shell",
			"command": "./.vscode/scripts/run-seatservice.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^You're up and running! Dapr logs will appear here.",
					"endsPattern": "."
				}
			}
		},
		{
			"label": "run-feedercan",
			"type": "shell",
			"command": "./.vscode/scripts/run-feedercan.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^You're up and running! Dapr logs will appear here.",
					"endsPattern": "."
				}
			}
		},
		{
			"label": "run-nginx",
			"type": "shell",
			"command": "./.vscode/scripts/run-nginx.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^addrs",
					"endsPattern": "."
				}
			}
		},
		{
			"label": "run-opa",
			"type": "shell",
			"command": "./.vscode/scripts/run-opa.sh --task",
			"group": "none",
			"presentation": {
				"reveal": "always",
				"panel": "dedicated"
			},
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^addrs",
					"endsPattern": "."
				}
			}
		},
		{
			"label": "Start VehicleApp runtime",
			"dependsOn": [
				"ensure-dapr",
				"run-mosquitto",
				"run-vehicledatabroker",
				"run-seatservice",
				"run-feedercan"
			],
			"dependsOrder": "sequence"
		},
		{
			"label": "SeatAdjuster (Dapr run)",
			"type":"shell",
			"command": [
				"dapr run",
				"--app-id seatadjuster",
				"--app-protocol grpc",
				"--app-port 50008",
				"--config ./.dapr/config.yaml",
				"--components-path ./.dapr/components",
				"python3 ./src/run.py"
			],
			"group": "none",
			"isBackground": true,
			"problemMatcher": {
				"pattern": [
					{
						"regexp": ".",
						"file": 1,
						"location": 2,
						"message": 3
					}
				],
				"background": {
					"activeOnStart": true,
					"beginsPattern": "^You're up and running! Both Dapr and your app logs will appear here.",
					"endsPattern": "."
				}
			}
		}
	]
}
